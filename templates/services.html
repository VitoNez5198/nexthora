{% extends "base.html" %}

{% block title %}Mis Servicios - Nexthora{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8">

    <!-- ENCABEZADO -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-dark-gray">‚úÇÔ∏è Mis Servicios</h1>
        <a href="{% url 'dashboard' %}" class="text-gray-500 hover:text-primary text-sm">‚Üê Volver al Dashboard</a>
    </div>

    <!-- MENSAJES (√âxito/Error) -->
    {% if messages %}
    <div class="mb-6">
        {% for message in messages %}
        <div
            class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 text-green-700{% else %}bg-red-100 text-red-700{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- COLUMNA IZQ: FORMULARIO DE CREACI√ìN -->
        <div class="lg:col-span-1">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 sticky top-6">
                <h2 class="text-lg font-bold text-dark-gray mb-4">Nuevo Servicio</h2>

                <!-- CONTADOR FREEMIUM -->
                <div class="mb-4 p-3 rounded-md text-sm font-medium flex justify-between items-center 
                    {% if services_count >= service_limit %} bg-red-50 text-red-700 border border-red-200
                    {% else %} bg-blue-50 text-blue-700 border border-blue-200 {% endif %}">
                    <span>Usados: {{ services_count }} / {{ service_limit }}</span>
                    {% if services_count >= service_limit %}
                    <span class="text-xs bg-white px-2 py-1 rounded border border-red-200">üîí Lleno</span>
                    {% endif %}
                </div>

                {% if services_count < service_limit %} <form method="POST" action="{% url 'services' %}">
                    {% csrf_token %}

                    <div class="space-y-4">
                        {% for field in form %}
                        <div>
                            <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                {{ field.label }}
                            </label>
                            {{ field }}
                            {% for error in field.errors %}
                            <p class="text-xs text-red-600 mt-1">{{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>

                    <button type="submit"
                        class="w-full mt-6 bg-primary text-white py-2 px-4 rounded-md hover:bg-blue-700 font-medium transition">
                        + Agregar Servicio
                    </button>
                    </form>
                    {% else %}
                    <div class="text-center py-6 bg-gray-50 rounded border border-dashed border-gray-300">
                        <p class="text-gray-500 text-sm">
                            Has alcanzado el l√≠mite de servicios. <br>
                            <span class="font-bold text-dark-gray">Elimina uno</span> para crear otro nuevo.
                        </p>
                    </div>
                    {% endif %}
            </div>
        </div>

        <!-- COLUMNA DER: LISTA DE SERVICIOS -->
        <div class="lg:col-span-2">
            <h2 class="text-lg font-bold text-dark-gray mb-4">Tus Servicios Activos</h2>

            {% if services %}
            <div class="space-y-4">
                {% for service in services %}
                <div
                    class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex justify-between items-center group hover:border-primary transition-colors {% if not service.is_active %} opacity-75 bg-gray-50 {% endif %}">
                    <div>
                        <div class="flex items-center gap-2">
                            <h3 class="font-bold text-gray-800 text-lg">{{ service.name }}</h3>
                            {% if not service.is_active %}
                            <span class="text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full">Oculto</span>
                            {% endif %}
                        </div>

                        <div class="flex items-center gap-4 text-sm text-gray-500 mt-1">
                            <span class="flex items-center gap-1">‚è±Ô∏è {{ service.duration_minutes }} min</span>
                            <!-- PRECIO SIN DECIMALES -->
                            <span class="flex items-center gap-1">üí≤ ${{ service.price|floatformat:0 }}</span>
                        </div>
                        {% if service.description %}
                        <p class="text-gray-400 text-sm mt-2 line-clamp-1">{{ service.description }}</p>
                        {% endif %}
                    </div>

                    <div class="flex items-center gap-2">
                        <!-- Bot√≥n Ocultar/Mostrar (Ojo) -->
                        <a href="{% url 'toggle_service' service.id %}"
                            class="p-2 text-gray-400 hover:text-blue-500 hover:bg-blue-50 rounded-full transition"
                            title="{% if service.is_active %}Ocultar{% else %}Mostrar{% endif %}">
                            {% if service.is_active %} üëÅÔ∏è {% else %} üëÅÔ∏è {% endif %}
                        </a>

                        <!-- Bot√≥n Editar (L√°piz) -->
                        <a href="{% url 'edit_service' service.id %}"
                            class="p-2 text-gray-400 hover:text-yellow-500 hover:bg-yellow-50 rounded-full transition"
                            title="Editar">
                            ‚úèÔ∏è
                        </a>

                        <!-- Bot√≥n Borrar -->
                        <form method="POST" action="{% url 'delete_service' service.id %}"
                            onsubmit="return confirm('¬øEst√°s seguro de eliminar este servicio?');">
                            {% csrf_token %}
                            <button type="submit"
                                class="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full transition"
                                title="Eliminar">
                                üóëÔ∏è
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <!-- Estado Vac√≠o -->
            <div class="bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-8 text-center">
                <div class="text-4xl mb-3">‚úÇÔ∏è</div>
                <h3 class="text-gray-900 font-medium">No tienes servicios a√∫n</h3>
                <p class="text-gray-500 text-sm mt-1">Usa el formulario de la izquierda para agregar tu primer servicio.
                </p>
            </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}